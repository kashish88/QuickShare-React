{"ast":null,"code":"var _jsxFileName = \"/Users/kashish/Documents/Instagram_Clone-React/src/Post.js\";\nimport React, { useState, useEffect } from 'react';\nimport './Post.css';\nimport Avatar from '@material-ui/core/Avatar';\nimport { db } from './firebase';\nimport DeleteIcon from '@material-ui/icons/Delete';\nimport FavoriteIcon from '@material-ui/icons/Favorite';\n\nfunction Post({\n  postId,\n  user,\n  username,\n  caption,\n  imageUrl\n}) {\n  const [comments, setComments] = useState([]);\n  const [comment, setComment] = useState('');\n  const [likes, setLikes] = useState(0);\n  const [liked, setLiked] = useState(false);\n  /*\n      useEffect(()=>{\n          let unsubscribe;\n    \n            if(postId) {\n                unsubscribe=db\n                .collection(\"posts\")\n                .doc(postId)\n                .collection(\"comments\")\n                .orderBy('timestamp','desc')\n                .onSnapshot((snapshot)=>{\n                    setComments(snapshot.docs.map((doc)=>doc.data()))\n                })\n            }\n            return ()=>{\n                unsubscribe();\n            };\n        },[postId]);\n  */\n\n  useEffect(() => {\n    let unsubscribeComments;\n    let unsubscribeLikes;\n\n    if (postId) {\n      // Fetch comments\n      unsubscribeComments = db.collection('posts').doc(postId).collection('comments').orderBy('timestamp', 'desc').onSnapshot(snapshot => {\n        setComments(snapshot.docs.map(doc => doc.data()));\n      }); // Fetch likes\n\n      unsubscribeLikes = db.collection('posts').doc(postId).collection('likes').onSnapshot(snapshot => {\n        setLikes(snapshot.size);\n      }); // Check if the current user has liked the post\n\n      if (user) {\n        db.collection('posts').doc(postId).collection('likes').doc(user.uid).get().then(doc => {\n          setLiked(doc.exists);\n        });\n      }\n    }\n\n    return () => {\n      unsubscribeComments && unsubscribeComments();\n      unsubscribeLikes && unsubscribeLikes();\n    };\n  }, [postId, user]);\n\n  const postComment = event => {\n    event.preventDefault();\n    db.collection(\"posts\").doc(postId).collection(\"comments\").add({\n      text: comment,\n      username: user.displayName //timestamp:firebase.firestore.FieldValue.serverTimestamp(),\n\n    });\n    setComment('');\n  };\n\n  const handleLike = () => {\n    // Toggle like status\n    const likeRef = db.collection('posts').doc(postId).collection('likes').doc(user.uid);\n\n    if (liked) {\n      likeRef.delete();\n    } else {\n      likeRef.set({\n        timestamp: new Date()\n      });\n    }\n\n    setLiked(!liked);\n  };\n\n  const handleDelete = () => {\n    db.collection(\"posts\").doc(postId).delete().then(function () {\n      console.log(\"Successfully deleted\");\n    }).catch(function (error) {\n      console.log(\"Error removing\", error);\n    });\n    /*\n    var desertRef=storage.child(name);\n    desertRef.delete().then(function(){\n        console.log(\"deleted successfully\");\n    }).catch(function(error){\n        //error\n    })\n    */\n  };\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"post\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 123,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"post_header\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 124,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Avatar, {\n    className: \"post_avatar\",\n    alt: \"R\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 126,\n      columnNumber: 17\n    }\n  }), /*#__PURE__*/React.createElement(\"h3\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 132,\n      columnNumber: 17\n    }\n  }, username), /*#__PURE__*/React.createElement(DeleteIcon, {\n    className: \"d\",\n    onClick: handleDelete,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 133,\n      columnNumber: 17\n    }\n  })), /*#__PURE__*/React.createElement(\"img\", {\n    className: \"post_image\",\n    src: imageUrl,\n    alt: \"\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 135,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(\"h4\", {\n    className: \"post_text\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 136,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"strong\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 136,\n      columnNumber: 39\n    }\n  }, username), \"  \", caption), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"post_actions\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 137,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"button\", {\n    onClick: handleLike,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 138,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(FavoriteIcon, {\n    color: liked ? 'secondary' : 'default',\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 139,\n      columnNumber: 21\n    }\n  })), /*#__PURE__*/React.createElement(\"span\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 141,\n      columnNumber: 17\n    }\n  }, likes, \" likes\")), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"post_comments\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 143,\n      columnNumber: 13\n    }\n  }, comments.map(comment => /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 145,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(\"strong\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 146,\n      columnNumber: 25\n    }\n  }, comment.username), \"  \", comment.text))), user && /*#__PURE__*/React.createElement(\"form\", {\n    className: \"post_commentBox\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 151,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"input\", {\n    className: \"post_input\",\n    type: \"text\",\n    placeholder: \"Add a comment..\",\n    value: comment,\n    onChange: e => setComment(e.target.value),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 152,\n      columnNumber: 21\n    }\n  }), /*#__PURE__*/React.createElement(\"button\", {\n    className: \"post_button\",\n    disabled: !comment,\n    type: \"submit\",\n    onClick: postComment,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 159,\n      columnNumber: 21\n    }\n  }, \"Post\")));\n}\n\nexport default Post;","map":{"version":3,"sources":["/Users/kashish/Documents/Instagram_Clone-React/src/Post.js"],"names":["React","useState","useEffect","Avatar","db","DeleteIcon","FavoriteIcon","Post","postId","user","username","caption","imageUrl","comments","setComments","comment","setComment","likes","setLikes","liked","setLiked","unsubscribeComments","unsubscribeLikes","collection","doc","orderBy","onSnapshot","snapshot","docs","map","data","size","uid","get","then","exists","postComment","event","preventDefault","add","text","displayName","handleLike","likeRef","delete","set","timestamp","Date","handleDelete","console","log","catch","error","e","target","value"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react'\nimport './Post.css'\nimport Avatar from '@material-ui/core/Avatar'\nimport { db } from './firebase';\nimport DeleteIcon from '@material-ui/icons/Delete';\nimport FavoriteIcon from '@material-ui/icons/Favorite';\n\nfunction Post({ postId, user, username, caption, imageUrl }) {\n\n    const [comments, setComments] = useState([]);\n    const [comment, setComment] = useState('')\n    const [likes, setLikes] = useState(0);\n    const [liked, setLiked] = useState(false);\n\n\n    /*\n        useEffect(()=>{\n            let unsubscribe;\n      \n              if(postId) {\n                  unsubscribe=db\n                  .collection(\"posts\")\n                  .doc(postId)\n                  .collection(\"comments\")\n                  .orderBy('timestamp','desc')\n                  .onSnapshot((snapshot)=>{\n                      setComments(snapshot.docs.map((doc)=>doc.data()))\n                  })\n              }\n              return ()=>{\n                  unsubscribe();\n              };\n          },[postId]);\n    */\n\n    useEffect(() => {\n        let unsubscribeComments;\n        let unsubscribeLikes;\n\n        if (postId) {\n            // Fetch comments\n            unsubscribeComments = db\n                .collection('posts')\n                .doc(postId)\n                .collection('comments')\n                .orderBy('timestamp', 'desc')\n                .onSnapshot((snapshot) => {\n                    setComments(snapshot.docs.map((doc) => doc.data()));\n                });\n\n            // Fetch likes\n            unsubscribeLikes = db\n                .collection('posts')\n                .doc(postId)\n                .collection('likes')\n                .onSnapshot((snapshot) => {\n                    setLikes(snapshot.size);\n                });\n\n            // Check if the current user has liked the post\n            if (user) {\n                db.collection('posts')\n                    .doc(postId)\n                    .collection('likes')\n                    .doc(user.uid)\n                    .get()\n                    .then((doc) => {\n                        setLiked(doc.exists);\n                    });\n            }\n        }\n\n        return () => {\n            unsubscribeComments && unsubscribeComments();\n            unsubscribeLikes && unsubscribeLikes();\n        };\n    }, [postId, user]);\n\n    const postComment = (event) => {\n        event.preventDefault();\n        db.collection(\"posts\").doc(postId).collection(\"comments\").add({\n            text: comment,\n            username: user.displayName,\n            //timestamp:firebase.firestore.FieldValue.serverTimestamp(),\n        });\n        setComment('');\n    }\n    const handleLike = () => {\n        // Toggle like status\n        const likeRef = db.collection('posts').doc(postId).collection('likes').doc(user.uid);\n\n        if (liked) {\n            likeRef.delete();\n        } else {\n            likeRef.set({\n                timestamp: new Date(),\n            });\n        }\n\n        setLiked(!liked);\n    };\n    const handleDelete = () => {\n\n        db.collection(\"posts\").doc(postId).delete().then(function () {\n            console.log(\"Successfully deleted\");\n        }).catch(function (error) {\n            console.log(\"Error removing\", error);\n        });\n        /*\n        var desertRef=storage.child(name);\n        desertRef.delete().then(function(){\n            console.log(\"deleted successfully\");\n        }).catch(function(error){\n            //error\n        })\n        */\n\n    }\n\n\n\n    return (\n        <div className=\"post\">\n            <div className=\"post_header\">\n\n                <Avatar\n                    className=\"post_avatar\"\n                    alt='R'\n\n                >\n                </Avatar>\n                <h3>{username}</h3>\n                <DeleteIcon className=\"d\" onClick={handleDelete} />\n            </div>\n            <img className=\"post_image\" src={imageUrl} alt=\"\"></img>\n            <h4 className=\"post_text\"><strong>{username}</strong>  {caption}</h4>\n            <div className=\"post_actions\">\n                <button onClick={handleLike}>\n                    <FavoriteIcon color={liked ? 'secondary' : 'default'} />\n                </button>\n                <span>{likes} likes</span>\n            </div>\n            <div className=\"post_comments\">\n                {comments.map((comment) => (\n                    <p >\n                        <strong>{comment.username}</strong>  {comment.text}\n                    </p>\n                ))}\n            </div>\n            {user && (\n                <form className=\"post_commentBox\">\n                    <input\n                        className=\"post_input\"\n                        type=\"text\"\n                        placeholder=\"Add a comment..\"\n                        value={comment}\n                        onChange={(e) => setComment(e.target.value)}\n                    />\n                    <button\n                        className=\"post_button\"\n                        disabled={!comment}\n                        type=\"submit\"\n                        onClick={postComment}\n\n\n\n                    >\n                        Post\n                    </button>\n\n\n\n\n                </form>\n            )}\n        </div>\n    )\n}\n\nexport default Post\n"]},"metadata":{},"sourceType":"module"}